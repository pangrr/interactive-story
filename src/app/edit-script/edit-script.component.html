<div class="container">
  <mat-accordion class="events" multi>
    <mat-expansion-panel *ngFor="let event of script.events; let i = index" [expanded]="event.open" (opened)="event.open = true"
      (closed)="event.open = false">
      <mat-expansion-panel-header>
        <div class="event-id-container truncate" *ngIf="!event.open">
          {{event.id}}
        </div>
        <div class="event-description-container truncate" *ngIf="!event.open">
          {{event.description}}
        </div>
        <div class="possible-next-events-container truncate" *ngIf="!event.open">
          <span *ngIf="event.nextEvent" class="next-event">{{event.nextEvent}}</span>
          <ng-container *ngFor="let action of event.actions">
            <span *ngIf="action.triggerEvent" class="next-event">{{action.triggerEvent}}</span>
          </ng-container>
        </div>
      </mat-expansion-panel-header>
      <table class="full-width" cellspacing="0">
        <tr>
          <td colspan="4">
            <mat-form-field class="full-width">
              <textarea matInput placeholder="Description" [(ngModel)]="event.description" matTextareaAutosize
                matAutosizeMinRows="1" matAutosizeMaxRows="5" required></textarea>
            </mat-form-field>
          </td>
        </tr>
        <tr *ngFor="let action of event.actions; let i = index" class="action" (mouseenter)="action.mouseover = true"
          (mouseleave)="action.mouseover = false">
          <td>
            <mat-form-field class="full-width">
              <input matInput placeholder="Action Description" [(ngModel)]="action.description" required>
            </mat-form-field>
          </td>
          <td>
            <mat-form-field class="full-width">
              <input matInput placeholder="Trigger Event" [(ngModel)]="action.triggerEvent">
            </mat-form-field>
          </td>
          <td>
            <mat-form-field class="full-width">
              <textarea matInput placeholder="Open Mind" [(ngModel)]="action.think" matTextareaAutosize
                matAutosizeMinRows="1" matAutosizeMaxRows="5"></textarea>
            </mat-form-field>
          </td>
          <td class="icon-cell">
            <button *ngIf="action.mouseover" mat-icon-button (click)="deleteAction(event, i)">
              <mat-icon svgIcon="delete" matTooltip="Delete Action"></mat-icon>
            </button>
          </td>
        </tr>
        <tr *ngFor="let note of event.updateNotes; let i = index" class="note" (mouseenter)="note.mouseover = true"
          (mouseleave)="note.mouseover = false">
          <td>
            <mat-form-field class="full-width">
              <input matInput placeholder="Note Title" [(ngModel)]="note.title" required>
            </mat-form-field>
          </td>
          <td colspan="2">
            <mat-form-field class="full-width">
              <textarea matInput placeholder="Note Content" [(ngModel)]="note.content" matTextareaAutosize
                matAutosizeMinRows="1" matAutosizeMaxRows="5"></textarea>
            </mat-form-field>
          </td>
          <td class="icon-cell">
            <button *ngIf="note.mouseover" mat-icon-button (click)="deleteNote(event, i)">
              <mat-icon svgIcon="delete" matTooltip="Delete Note"></mat-icon>
            </button>
          </td>
        </tr>
      </table>
      <div class="event-control">
        <mat-form-field>
          <input matInput placeholder="Event ID" [(ngModel)]="event.id" required>
        </mat-form-field>
        <mat-form-field>
          <input matInput placeholder="Next Event" [(ngModel)]="event.nextEvent">
        </mat-form-field>
        <span class="spacer"></span>
        <button mat-button color="primary" (click)="addAction(event)">Add Action</button>
        <button mat-button (click)="addNote(event)">Add Note</button>
        <button mat-button color="warn" (click)="deleteEvent(i)">Delete Event</button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
  <div color="primary" class="toolbar">
    <mat-form-field>
      <input matInput placeholder="First Event" [(ngModel)]="script.firstEvent" required>
    </mat-form-field>
    <span class="spacer"></span>
    <button mat-button (click)="addEvent()">Add Event</button>
    <button mat-button (click)="sortEvents()">Sort Events</button>
    <button mat-button (click)="closeEvents()">Close Events</button>
    <button mat-button color="primary" (click)="showScriptJson()">Script JSON</button>
    <button mat-button color="accent" (click)="validateScript()">Validate Script</button>
  </div>
</div>